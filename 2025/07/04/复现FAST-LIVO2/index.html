<!DOCTYPE html>
<html lang="en">
<style>
    p{
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
        font-size: 1.1rem;
    }
    figure{
        margin: 0 !important;
    }
    pre{
        padding: 0 !important;
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
    }

    td{
        padding: 0 !important;
        margin-bottom: 1rem !important;
    }
    h1,h2,h3,h4,h5,h6{
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
    }
    @media (min-width: 1024px) {
        #middle-box{
            min-width: 56rem;
        }
    
    }
</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ether Blog - 复现FAST-LIVO2</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/tailwind.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/toc.css">
    
<header class="bg-black text-hacker-white py-4 font-dos font-extrabold">
    <div class="container mx-auto flex items-center justify-between space-x-8">
    
      <h1 class="text-2xl font-bold ml-[100px] md:ml-0 animate-pulse text-hacker-color1 md:mr-[20%]">
        <a href="/" class="hover:text-white transition-colors select-none">
          Ether Blog
        </a>
      </h1>
  
    <!-- 大屏幕 -->
      <nav class="hidden md:block">
        <ul class="flex space-x-6">
          
            <li>
              <a href="/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Home
              </a>
            </li>
          
            <li>
              <a href="/archives/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Archives
              </a>
            </li>
          
            <li>
              <a href="/categories/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Categories
              </a>
            </li>
          
            <li>
              <a href="/tags/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Tags
              </a>
            </li>
          
            <li>
              <a href="/about/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                About
              </a>
            </li>
          
            <li>
              <a href="/rss.xml" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                RSS
              </a>
            </li>
          
        </ul>
      </nav>
  
      <!-- 小屏幕 -->
      <button id="menu-toggle" class="block md:hidden text-white focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  
    <!-- 折叠菜单 -->
    <nav id="mobile-menu" class="hidden bg-black">
      <ul class="space-y-2 py-4 px-6">
        
          <li>
            <a href="/" class="block text-white hover:text-hacker-color1 transition-colors">
              Home
            </a>
          </li>
        
          <li>
            <a href="/archives/" class="block text-white hover:text-hacker-color1 transition-colors">
              Archives
            </a>
          </li>
        
          <li>
            <a href="/categories/" class="block text-white hover:text-hacker-color1 transition-colors">
              Categories
            </a>
          </li>
        
          <li>
            <a href="/tags/" class="block text-white hover:text-hacker-color1 transition-colors">
              Tags
            </a>
          </li>
        
          <li>
            <a href="/about/" class="block text-white hover:text-hacker-color1 transition-colors">
              About
            </a>
          </li>
        
          <li>
            <a href="/rss.xml" class="block text-white hover:text-hacker-color1 transition-colors">
              RSS
            </a>
          </li>
        
      </ul>
    </nav>
  
    <!-- RSS Link -->
    <link rel="alternate" type="application/rss+xml" title=" RSS" href="/rss.xml" />
  </header>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/search.js"></script>
  <script>
        document.addEventListener("DOMContentLoaded", () => {
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");

    menuToggle.addEventListener("click", () => {
        if (mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.remove("hidden");
        } else {
        mobileMenu.classList.add("hidden");
        }
    });
    });

  </script>
  

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>
<body class="bg-black text-hacker-color3 container mx-auto" style="overflow-x:hidden">
    <!-- 文章标题 -->
    <h1 class="text-5xl text-hacker-color1 font-bold font-dos my-6 text-center">复现FAST-LIVO2</h1>

    <!-- 发布时间 -->
    <p class="text-hacker-color3 text-center text-sm mb-4">
        2025-07-04
    </p>

    <!-- 文章内容 -->
    <div id="article-content" class="article-entry prose prose-invert mx-auto max-w-4xl leading-relaxed highlight" style="display: flex;">
        <div id="middle-box">
            <h1 id="项目名称-FAST-LIVO2复现"><a href="#项目名称-FAST-LIVO2复现" class="headerlink" title="项目名称 : FAST-LIVO2复现"></a>项目名称 : FAST-LIVO2复现</h1><h2 id="任务规划"><a href="#任务规划" class="headerlink" title="任务规划"></a>任务规划</h2><ul>
<li><p>设备:</p>
<ol>
<li>Livox AVIA</li>
<li>Livox Converter 2.0</li>
<li>海康相机MV-CS020-10UC</li>
</ol>
</li>
<li><p>硬件:</p>
<ol>
<li><p>手持设备支架设计(Solidworks)</p>
</li>
<li><p>STM32硬同步流程</p>
</li>
<li><p>相机-Lidar标定</p>
</li>
</ol>
</li>
<li><p>软件:</p>
<ol>
<li>环境,build</li>
<li>录包,跑包</li>
</ol>
</li>
</ul>
<h2 id="论文阅读"><a href="#论文阅读" class="headerlink" title="论文阅读"></a>论文阅读</h2><h3 id="FAST-LIVO"><a href="#FAST-LIVO" class="headerlink" title="FAST-LIVO"></a>FAST-LIVO</h3><ul>
<li><p>LIO 子系统: 反向传播补偿 LiDAR 扫描的运动畸变,计算帧到地图点到平面的残差。</p>
</li>
<li><p>VIO 子系统: 提取当前 FoV 中的视觉子映射,剔除异常值。</p>
</li>
<li><p>视觉对齐: 稀疏直接图像对齐,比较光流误差。</p>
</li>
<li><p>紧密耦合: 点到平面残差和图像光度误差与误差状态iKF中的IMU传播紧密耦合。</p>
</li>
<li><p>ikdTree添加新点至全局映射。</p>
<img src="../images/复现FAST-LIVO2/1.png" alt="1" style="zoom: 50%;" /></li>
</ul>
<h3 id="FAST-LIVO2"><a href="#FAST-LIVO2" class="headerlink" title="FAST-LIVO2"></a>FAST-LIVO2</h3><h2 id="STM32硬同步"><a href="#STM32硬同步" class="headerlink" title="STM32硬同步"></a>STM32硬同步</h2><h3 id="1-材料"><a href="#1-材料" class="headerlink" title="1. 材料"></a>1. 材料</h3><ul>
<li>工程文件 : <a target="_blank" rel="noopener" href="https://github.com/xuankuzcr/LIV_handhold/tree/main/stm32_timersync-open">stm32_timersync-open</a></li>
<li>烧录器 : ST-LINK V2</li>
<li>STM32F103C8T6</li>
<li>TTL to USB</li>
<li>TTL to RS485</li>
</ul>
<h3 id="2-原理图"><a href="#2-原理图" class="headerlink" title="2. 原理图"></a>2. 原理图</h3><p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/15.png" alt="论文硬同步原理图"></p>
<p>Livox_avia不支持直接读取GPRMC格式的指令,mid360支持直接读取.如果使用mid360连线原理图将会改变.本篇只考虑Livox_avia.</p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/16.png" alt="逻辑原理图"></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/19.png" alt="原理图"></p>
<h3 id="3-硬件连线图"><a href="#3-硬件连线图" class="headerlink" title="3. 硬件连线图"></a>3. 硬件连线图</h3><p>**硬件连线参考图 : ** </p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/31.png" alt="硬件连线图"></p>
<p>相机线说明 :</p>
<p>相机的电源及 I&#x2F;O 接口为 6-pin P7 接口。</p>
<img src="../images/复现FAST-LIVO2/32.png" alt="相机线" style="zoom:67%;" />

<p>Livox Converter 2.0 同步线说明 :</p>
<img src="../images/复现FAST-LIVO2/33.png" alt="雷达同步线" style="zoom:67%;" />



<h3 id="4-雷达设置"><a href="#4-雷达设置" class="headerlink" title="4. 雷达设置"></a>4. 雷达设置</h3><h4 id="Livox雷达时间同步说明"><a href="#Livox雷达时间同步说明" class="headerlink" title="Livox雷达时间同步说明"></a>Livox雷达时间同步说明</h4><p>参考:<a target="_blank" rel="noopener" href="https://github.com/Livox-SDK/Livox-SDK/wiki/livox-device-time-synchronization-manual-cn#%E9%99%84%E5%BD%95">https://github.com/Livox-SDK/Livox-SDK/wiki/livox-device-time-synchronization-manual-cn#%E9%99%84%E5%BD%95</a></p>
<p>Livox设备支持3种时间同步方式：</p>
<ul>
<li>PTP：IEEE 1588v2.0 PTP 网络协议同步；</li>
<li>GPS：秒脉冲+GPRMC时间数据，组成GPS时间同步方式；</li>
<li>PPS：秒脉冲同步，需要上层应用程序通过其他途径（如：uart）获取每个脉冲的时间信息，并修正点云时间。</li>
</ul>
<p>FAST-LIO只涉及GPS和PPS两种,只介绍这两种.</p>
<h5 id="GPS"><a href="#GPS" class="headerlink" title="GPS"></a>GPS</h5><p>GPS时钟源的PPS端口每秒发送一次硬件脉冲（PPS信号），随后数据端口发送一次对应这个脉冲上升沿的时间信息（GPRMC格式）。Livox设备接收到PPS信号上升沿，并由GPRMC数据解析出正确的时间信息后，会设置点云时间为GPS时间，并保持此时间基准持续累加，来实现和GPS设备的时间同步。</p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/17.png" alt="GPS原理图"></p>
<p><strong>Livox Converter 2.0</strong>将GPS模块的时间信号（GPRMC）通过TTL转usb模块接入PC，PPS信号接入LiDAR转接盒同步口（Sync Port）。</p>
<p>如果GPS模块的时间信号和PPS信号是TTL电平，则需要进行如下的电平转换后，才能将信号接入Hub的GPS时间同步口（GPS sync port）。</p>
<img src="../images/复现FAST-LIVO2/18.png" style="zoom: 67%;" />

<h5 id="PPS"><a href="#PPS" class="headerlink" title="PPS"></a>PPS</h5><p>Livox LiDAR每次接收到PPS信号的上升沿后，会将当前时刻的点云时间置为0，然后重新开始计时直到下一个PPS脉冲到来,利用这个特性，来实现PPS脉冲对LiDAR时间的同步。</p>
<p>伪代码:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// PPS Time Synchronization</span><br><span class="hljs-type">static</span> <span class="hljs-type">uint64_t</span> lidar_time_last;<br><span class="hljs-type">static</span> <span class="hljs-type">uint64_t</span> lidar_time_real;<br><br><span class="hljs-comment">// 1. Read the PPS rising edge time, Unit is nanosecond.</span><br><span class="hljs-type">uint64_t</span> pps_time_ns = get_pps_rising_nsecond();<br><span class="hljs-comment">// 2. Read LiDAR point time, Unit is nanosecond.</span><br><span class="hljs-type">uint64_t</span> lidar_time = get_lidar_pack_time();<br><span class="hljs-comment">// 3. Update real time.</span><br><span class="hljs-keyword">if</span> (lidar_time &lt; lidar_time_last)<br>&#123;<br>    <span class="hljs-comment">//LiDAR time jump indicates the generation of PPS rising edge.</span><br>    lidar_time_real = pps_time_ns + lidar_time%(<span class="hljs-number">1000000000</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    lidar_time_real += lidar_time - lidar_time_last;<br>&#125;<br><span class="hljs-comment">//Update history</span><br>lidar_time_last = lidar_time;<br></code></pre></td></tr></table></figure>





<p>先安装Livox雷达的客户端，查看雷达的连接转态和数据的读取状态，来确认雷达是否已进入PPS同步状态</p>
<p>这里使用的客户端为：<br> <strong>Livox Viewer 0.10.0(64bit)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">注意：Livox Viewer2并不支持Avia<br></code></pre></td></tr></table></figure>

<p>1.livox_lidar_config.json中，修改参数值：[包下载见工作空间配置]</p>
<h3 id="相机设置"><a href="#相机设置" class="headerlink" title="相机设置"></a>相机设置</h3><h3 id="烧录"><a href="#烧录" class="headerlink" title="烧录"></a>烧录</h3><ol>
<li><p>STLINK驱动安装</p>
<p><a target="_blank" rel="noopener" href="https://docs.qq.com/doc/DT2hyS2ZjY21WQkZt">https://docs.qq.com/doc/DT2hyS2ZjY21WQkZt</a></p>
</li>
<li><p>硬件连接</p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/20.png" alt="烧录硬件连接原理图"></p>
<img src="../images/复现FAST-LIVO2/21.jpg" alt="烧录硬件连接实物图" style="zoom: 25%;" /></li>
</ol>
<img src="../images/复现FAST-LIVO2/22.jpg" alt="烧录硬件连接实物图" style="zoom: 25%;" />

<img src="../images/复现FAST-LIVO2/23.jpg" alt="烧录硬件连接实物图" style="zoom: 25%;" />

<ol start="3">
<li><p>Keil烧录</p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/24.png" alt="烧录过程1"></p>
</li>
</ol>
<p>​	<img src="../images/复现FAST-LIVO2/25.png" alt="烧录过程2" style="zoom:50%;" /></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/26.png" alt="烧录过程3"></p>
<img src="../images/复现FAST-LIVO2/27.png" alt="烧录过程4" style="zoom:50%;" />

<img src="../images/复现FAST-LIVO2/28.png" alt="烧录过程5" style="zoom:50%;" />

<img src="../images/复现FAST-LIVO2/29.png" alt="烧录过程6" style="zoom:50%;" />

<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/30.png" alt="烧录过程7"></p>
<h2 id="本机环境"><a href="#本机环境" class="headerlink" title="本机环境"></a>本机环境</h2><ol>
<li><p>NVIDIA驱动 : </p>
<ul>
<li><p><strong>关闭bios security boot</strong></p>
</li>
<li><p>在命令行模式下删除之前安装的nvidia驱动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Ctrl + Alt + F3<br>sudo systemctl stop gdm<br>sudo apt-get purge &#x27;^nvidia-.*&#x27;<br>sudo apt-get autoremove<br>sudo rm -rf /etc/X11/xorg.conf<br>sudo rm -rf /lib/modules/$(uname -r)/kernel/drivers/video/nvidia*<br>sudo rm -rf /usr/src/nvidia*<br>sudo rm -rf /usr/share/doc/NVIDIA_GLX-1.0*<br>sudo rm -rf /usr/share/man/man1/nvidia*<br>sudo rm -rf /usr/bin/nvidia*<br>sudo rm -rf /etc/modprobe.d/blacklist-nvidia.conf<br></code></pre></td></tr></table></figure>
</li>
<li><p>重新安装,选择recommend的版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo ubuntu-drivers devices # 查看可以使用的驱动版本<br></code></pre></td></tr></table></figure>
</li>
<li><p>重启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">reboot<br></code></pre></td></tr></table></figure>
</li>
<li><p>检查</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">nvidia-smi<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h2 id="NUC环境搭建"><a href="#NUC环境搭建" class="headerlink" title="NUC环境搭建"></a>NUC环境搭建</h2><h3 id="1-修网卡"><a href="#1-修网卡" class="headerlink" title="1. 修网卡"></a>1. 修网卡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">fast@fast:~/WIFI/backport-iwlwifi$ lspci | grep -i wireless<br>fast@fast:~/WIFI/backport-iwlwifi$ lsmod | grep iwl<br></code></pre></td></tr></table></figure>

<p>系统没有识别出无线网卡设备,疑似硬件问题.最后使用网线上网.</p>
<h3 id="2-依赖项"><a href="#2-依赖项" class="headerlink" title="2. 依赖项"></a>2. 依赖项</h3><ul>
<li><p>PCL&gt;&#x3D;1.8, Follow <a target="_blank" rel="noopener" href="https://pointclouds.org/">PCL Installation</a>.</p>
</li>
<li><p>Eigen&gt;&#x3D;3.3.4, Follow <a target="_blank" rel="noopener" href="https://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen Installation</a>.</p>
</li>
<li><p>OpenCV&gt;&#x3D;4.2, Follow <a target="_blank" rel="noopener" href="http://opencv.org/">Opencv Installation</a>.</p>
</li>
<li><p>Livox_SDK2 :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git clone https://github.com/Livox-SDK/Livox-SDK2.git<br>cd ./Livox-SDK2/<br>mkdir build<br>cd build<br>cmake .. &amp;&amp; make -j<br>sudo make install<br></code></pre></td></tr></table></figure>
</li>
<li><p>Sophus : Sophus Installation for the non-templated&#x2F;double-only version.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git clone https://github.com/strasdat/Sophus.git<br>cd Sophus<br>git checkout a621ff<br>mkdir build &amp;&amp; cd build &amp;&amp; cmake ..<br>make<br>sudo make install<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-工作空间配置"><a href="#3-工作空间配置" class="headerlink" title="3. 工作空间配置"></a>3. 工作空间配置</h3><p>AVIA不支持livox_ros_driver2,只支持livox_ros_driver</p>
<p>livox_ros_driver可以不着急先编译,等最后一起build</p>
<ul>
<li><p>FAST_LIVO2 : <a target="_blank" rel="noopener" href="https://github.com/hku-mars/FAST-LIVO2.git">https://github.com/hku-mars/FAST-LIVO2.git</a></p>
</li>
<li><p>livox_ros_ driver : <a target="_blank" rel="noopener" href="https://github.com/Livox-SDK/livox_ros_driver.git">https://github.com/Livox-SDK/livox_ros_driver.git</a></p>
<p> <a href="#change">&lt;说明&gt;</a>如果使用硬同步,则使用这个github库中的livox_ros_driver,<strong>对比官方,这里做了硬同步的改动，增加了对共享内存写入时间戳的功能</strong> : <a target="_blank" rel="noopener" href="https://github.com/xuankuzcr/LIV_handhold.git">https://github.com/xuankuzcr/LIV_handhold.git</a></p>
</li>
<li><p>mvs_ros_pkg : <a target="_blank" rel="noopener" href="https://github.com/ChongjianYUAN/mvs_ros_pkg.git">https://github.com/ChongjianYUAN/mvs_ros_pkg.git</a></p>
</li>
<li><p>rpg_vikit : <a target="_blank" rel="noopener" href="https://github.com/xuankuzcr/rpg_vikit.git">https://github.com/xuankuzcr/rpg_vikit.git</a> (使用这个url,否则编译时出错)</p>
<p>  如果需要查看&#x2F;livox&#x2F;imu或者&#x2F;livox&#x2F;lidar数据 , 额外添加livox_ros_driver包</p>
<ul>
<li>livox_ros_ driver : <a target="_blank" rel="noopener" href="https://github.c/Livox-SDK/livox_ros_driver">https://github.c/Livox-SDK/livox_ros_driver</a></li>
</ul>
</li>
</ul>
<ol start="4">
<li><p>Build :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd ~/fast_livo2_ws/src<br>cd livox_ros_driver2<br>./build.sh ROS1<br>cd ../..<br>catkin_make<br>source ~/fast_livo2_ws/devel/setup.bash<br></code></pre></td></tr></table></figure></li>
</ol>
<p>​	<a name="change"></a></p>
<ul>
<li><p>注 : </p>
</li>
<li><p>关于<strong>livox_ros_driver</strong>的改动</p>
<p>使用meld对比两份文件夹 ,  新的livox_ros_driver增加了共享内存以及对共享内存写入时间戳的功能.</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">+ livox_ros_driver.cpp<br>	 <span class="hljs-comment">// 将文件映射为一个共享内存区域，大小为sizeof(time_stamp)，通过指针pointt可以直接读写它。</span><br>	  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *user_name = <span class="hljs-built_in">getlogin</span>();<br>      std::string path_for_time_stamp = <span class="hljs-string">&quot;/home/&quot;</span> + std::<span class="hljs-built_in">string</span>(user_name) + <span class="hljs-string">&quot;/timeshare&quot;</span>;<br>      <span class="hljs-type">const</span> <span class="hljs-type">char</span> *shared_file_name = path_for_time_stamp.<span class="hljs-built_in">c_str</span>();<br>      <span class="hljs-type">int</span> fd = <span class="hljs-built_in">open</span>(shared_file_name, O_CREAT | O_RDWR | O_TRUNC, <span class="hljs-number">0666</span>);<br>      <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) &#123;<br>        <span class="hljs-built_in">ERR_EXIT</span>(<span class="hljs-string">&quot;open&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;open code: %d\n&quot;</span>, fd);<br>      &#125;<br>      <span class="hljs-built_in">lseek</span>(fd, <span class="hljs-built_in">sizeof</span>(time_stamp) * <span class="hljs-number">1</span>, SEEK_SET);<br>      <span class="hljs-built_in">write</span>(fd, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">1</span>);<br>      pointt = (time_stamp *)<span class="hljs-built_in">mmap</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-built_in">sizeof</span>(time_stamp) * <span class="hljs-number">1</span>,<br>                                  PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li><p>关于<strong>livox_ros_driver2</strong>的改动</p>
<p>新的livox_ros_driver2增加了共享内存以及对共享内存写入时间戳的功能.</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++">+lddc.cpp<br>    <span class="hljs-comment">// 实现了用一个普通文件作为共享内存的载体，进程间可以通过映射该文件进行数据共享。</span><br>    <span class="hljs-comment">// 结构体time_stamp用于在多个进程（或设备驱动与应用程序）间共享硬件时间戳。</span><br>    <span class="hljs-comment">//******************************************************************** add code</span><br>    <span class="hljs-keyword">if</span> (isOpended == <span class="hljs-literal">false</span>)<br>    &#123;<br>      <span class="hljs-type">const</span> <span class="hljs-type">char</span> *user_name = <span class="hljs-built_in">getlogin</span>();<br>      std::string path_for_time_stamp = <span class="hljs-string">&quot;/home/&quot;</span> + std::<span class="hljs-built_in">string</span>(user_name) + <span class="hljs-string">&quot;/timeshare&quot;</span>;<br><br>      <span class="hljs-type">const</span> <span class="hljs-type">char</span> *shared_file_name = path_for_time_stamp.<span class="hljs-built_in">c_str</span>();<br>      <span class="hljs-type">int</span> fd = <span class="hljs-built_in">open</span>(shared_file_name, O_CREAT | O_RDWR | O_TRUNC, <span class="hljs-number">0666</span>);<br>      <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>)<br>      &#123;<br>        <span class="hljs-built_in">ROS_ERROR</span>(<span class="hljs-string">&quot;open failed\n&quot;</span>);<br>        isOpended = <span class="hljs-literal">false</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-built_in">ROS_ERROR</span>(<span class="hljs-string">&quot;open code: %d\n&quot;</span>, fd);<br>        isOpended = <span class="hljs-literal">true</span>;<br>      &#125;<br>      <span class="hljs-built_in">lseek</span>(fd, <span class="hljs-built_in">sizeof</span>(time_stamp) * <span class="hljs-number">1</span>, SEEK_SET);<br>      <span class="hljs-built_in">write</span>(fd, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">1</span>);<br>      pointt = (time_stamp *)<span class="hljs-built_in">mmap</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-built_in">sizeof</span>(time_stamp) * <span class="hljs-number">1</span>,<br>                                  PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-comment">//********************************************************************</span><br></code></pre></td></tr></table></figure>




<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h4 id="跑包"><a href="#跑包" class="headerlink" title="跑包"></a>跑包</h4><p>HKU_Lecture_Center_02.bag</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">roslaunch fast_livo mapping_avia.launch<br>rosbag play HKU_Lecture_Center_02.bag<br></code></pre></td></tr></table></figure>

<h5 id="rviz"><a href="#rviz" class="headerlink" title="rviz"></a>rviz</h5><p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/2.jpg" alt="2"></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/3.jpg" alt="3"></p>
<p>墙面与地面分界线清晰</p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/4.jpg" alt="7"></p>
<p>图片处理(拉高亮度)后,可以看到墙面纹路,转角非常清晰</p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/5.jpg" alt="5"></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/6.jpg" alt="6"></p>
<h5 id="系统资源占用"><a href="#系统资源占用" class="headerlink" title="系统资源占用"></a>系统资源占用</h5><p>运行launch和rviz : 资源主要由rviz占用,且初始rviz config中点云queue数值极大,NUC很卡</p>
<table>
<thead>
<tr>
<th align="center"><strong>字段</strong></th>
<th align="center"><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">PRI</td>
<td align="center">Priority（优先级）</td>
</tr>
<tr>
<td align="center">NI</td>
<td align="center">Nice 值（友好度）</td>
</tr>
<tr>
<td align="center">VIRT</td>
<td align="center">Virtual Memory（虚拟内存大小）</td>
</tr>
<tr>
<td align="center">RES</td>
<td align="center">Resident Memory（常驻内存） 当前进程实际占用的物理内存大小</td>
</tr>
<tr>
<td align="center">SHR</td>
<td align="center">Shared Memory（共享内存）</td>
</tr>
<tr>
<td align="center">S</td>
<td align="center">State（进程状态）R：运行（Running）S：休眠（Sleeping）</td>
</tr>
<tr>
<td align="center">CPU%</td>
<td align="center">进程当前使用的 CPU 百分比（所有核总和）</td>
</tr>
<tr>
<td align="center">MEM%</td>
<td align="center">进程使用的物理内存占系统总内存的百分比</td>
</tr>
</tbody></table>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/7.jpg" alt="7"></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/8.jpg" alt="8"></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/9.jpg" alt="9"></p>
<p>只运行launch: </p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/10.jpg" alt="10"></p>
<h5 id="里程计数据"><a href="#里程计数据" class="headerlink" title="里程计数据"></a>里程计数据</h5><p>纵轴单位(m) ,三条曲线分别是x轴,y轴,z轴里程计数据变化</p>
<ul>
<li><p>蓝色-x轴</p>
</li>
<li><p>红色-y轴</p>
</li>
<li><p>绿色-z轴</p>
<p>取最后一段平稳曲线部分放大 : 静态波动在厘米级,峰峰值4-6cm</p>
</li>
</ul>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/11.jpg" alt="11"></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/12.png" alt="12"></p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/13.jpg" alt="13"></p>
<h5 id="处理时间"><a href="#处理时间" class="headerlink" title="处理时间"></a>处理时间</h5><p>参考该帧处理时间数量级</p>
<p><img src="/../images/%E5%A4%8D%E7%8E%B0FAST-LIVO2/14.jpg" alt="14"></p>

        </div>
        
            <div class="post-container">
            <aside class="toc-container">
                <button class="toc-toggle">文章目录</button>
                <nav class="toc" id="toc"></nav>
            </aside>
        </div>
        
    </div>


    <!-- 返回主页链接 -->
    <div class="text-center my-8">
        <a href="/" class="text-hacker-color1 underline hover:text-hacker-color2">← Back to Home</a>
    </div>

      
      <script src="/js/toc.js"></script>  <!-- 引入 TOC 逻辑 -->
      
      

    <footer class="bg-black text-gray-400 py-4">
    <div class="container mx-auto text-center">
      <p>© <span id="current-year"></span>  Li-shuangyi 
        <br> Powered by <a class="hover:text-white duration-150 hover:underline decoration-slice" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & <a class="hover:text-white duration-150 hover:underline decoration-slice" target="_blank" rel="noopener" href="https://github.com/m310ct/hexo-theme-hexploit">Hexpolit</a></p>
    </div>
  </footer>
  
  <script> 
    document.getElementById("current-year").textContent = new Date().getFullYear();
  </script>
  


</body>
</html>
