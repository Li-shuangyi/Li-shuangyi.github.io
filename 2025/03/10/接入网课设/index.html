<!DOCTYPE html>
<html lang="en">
<style>
    p{
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
        font-size: 1.1rem;
    }
    figure{
        margin: 0 !important;
    }
    pre{
        padding: 0 !important;
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
    }

    td{
        padding: 0 !important;
        margin-bottom: 1rem !important;
    }
    h1,h2,h3,h4,h5,h6{
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
    }
    @media (min-width: 1024px) {
        #middle-box{
            min-width: 56rem;
        }
    
    }
</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ether Blog - 接入网综合课设</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/tailwind.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/toc.css">
    
<header class="bg-black text-hacker-white py-4 font-dos font-extrabold">
    <div class="container mx-auto flex items-center justify-between space-x-8">
    
      <h1 class="text-2xl font-bold ml-[100px] md:ml-0 animate-pulse text-hacker-color1 md:mr-[20%]">
        <a href="/" class="hover:text-white transition-colors select-none">
          Ether Blog
        </a>
      </h1>
  
    <!-- 大屏幕 -->
      <nav class="hidden md:block">
        <ul class="flex space-x-6">
          
            <li>
              <a href="/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Home
              </a>
            </li>
          
            <li>
              <a href="/archives/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Archives
              </a>
            </li>
          
            <li>
              <a href="/categories/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Categories
              </a>
            </li>
          
            <li>
              <a href="/tags/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                Tags
              </a>
            </li>
          
            <li>
              <a href="/about/" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                About
              </a>
            </li>
          
            <li>
              <a href="/rss.xml" class="select-none text-lg hover:text-hacker-color1 transition-all hover:underline decoration-wavy duration-300 text-hacker-color3">
                RSS
              </a>
            </li>
          
        </ul>
      </nav>
  
      <!-- 小屏幕 -->
      <button id="menu-toggle" class="block md:hidden text-white focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  
    <!-- 折叠菜单 -->
    <nav id="mobile-menu" class="hidden bg-black">
      <ul class="space-y-2 py-4 px-6">
        
          <li>
            <a href="/" class="block text-white hover:text-hacker-color1 transition-colors">
              Home
            </a>
          </li>
        
          <li>
            <a href="/archives/" class="block text-white hover:text-hacker-color1 transition-colors">
              Archives
            </a>
          </li>
        
          <li>
            <a href="/categories/" class="block text-white hover:text-hacker-color1 transition-colors">
              Categories
            </a>
          </li>
        
          <li>
            <a href="/tags/" class="block text-white hover:text-hacker-color1 transition-colors">
              Tags
            </a>
          </li>
        
          <li>
            <a href="/about/" class="block text-white hover:text-hacker-color1 transition-colors">
              About
            </a>
          </li>
        
          <li>
            <a href="/rss.xml" class="block text-white hover:text-hacker-color1 transition-colors">
              RSS
            </a>
          </li>
        
      </ul>
    </nav>
  
    <!-- RSS Link -->
    <link rel="alternate" type="application/rss+xml" title=" RSS" href="/rss.xml" />
  </header>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/search.js"></script>
  <script>
        document.addEventListener("DOMContentLoaded", () => {
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");

    menuToggle.addEventListener("click", () => {
        if (mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.remove("hidden");
        } else {
        mobileMenu.classList.add("hidden");
        }
    });
    });

  </script>
  

<meta name="generator" content="Hexo 7.3.0"></head>
<body class="bg-black text-hacker-color3 container mx-auto" style="overflow-x:hidden">
    <!-- 文章标题 -->
    <h1 class="text-5xl text-hacker-color1 font-bold font-dos my-6 text-center">接入网综合课设</h1>

    <!-- 发布时间 -->
    <p class="text-hacker-color3 text-center text-sm mb-4">
        2025-03-10
    </p>

    <!-- 文章内容 -->
    <div id="article-content" class="article-entry prose prose-invert mx-auto max-w-4xl leading-relaxed highlight" style="display: flex;">
        <div id="middle-box">
            <h1 id="接入网综合课设"><a href="#接入网综合课设" class="headerlink" title="接入网综合课设"></a>接入网综合课设</h1><h2 id="阶段一"><a href="#阶段一" class="headerlink" title="阶段一"></a>阶段一</h2><ol>
<li><p>完成虚拟机选型，并配置至少两个网段， 分别测试子网内和子网间连通性； </p>
</li>
<li><p>设计PPPOE本地认证拓扑图及IP地址规划 (客户至少两个网段)  ；</p>
</li>
<li><p>选型PPPOE服务器软件，并在虚拟环境下 完成PPPoE接入本地认证的搭建、配置、 实验测试。</p>
</li>
</ol>
<h3 id="任务一"><a href="#任务一" class="headerlink" title="任务一"></a>任务一</h3><h4 id="子网规划"><a href="#子网规划" class="headerlink" title="子网规划"></a>子网规划</h4><p>虚拟机选型：ubuntu20.04</p>
<p>配置网段：</p>
<ul>
<li>Vmnet1:192.168.10.0&#x2F;24</li>
<li>Vmnet2:192.168.20.0&#x2F;24 </li>
<li>Vmnet3:192.168.30.0&#x2F;24</li>
</ul>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/1.png" alt="子网规划"></p>
<h4 id="配置流程"><a href="#配置流程" class="headerlink" title="配置流程"></a>配置流程</h4><ol>
<li>在ubuntu编辑-虚拟网络编辑器中选择更改设置，赋予管理员权限后选择添加网络，类型为<strong>仅主机模式</strong>，修改子网IP和子网掩码。</li>
</ol>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/2.png" alt="虚拟网络编辑器"></p>
<ol start="2">
<li>在ubuntu虚拟机设置中添加网卡，三张为子网规划中定义所对应的网卡。</li>
</ol>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/3.png" alt="虚拟机设置"></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/4.png" alt="硬件设置"></p>
<p>对应网络适配器选择自定义-特定虚拟网络-选择对应网卡-确定。</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/5.png" alt="虚拟机设置"></p>
<ol start="3">
<li>在ubuntu中输入</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">ifconfig<br></code></pre></td></tr></table></figure>

<p>出现对应网卡信息。</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/6.png" alt="网卡信息"></p>
<ol start="4">
<li>配置静态IP。参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_58305495/article/details/130554393">Ubuntu配置静态IP</a>，注意与网卡名称匹配。</li>
</ol>
<p><strong>Ubuntu 16.04 及更早版本</strong>：网络管理工具使用 <code>ifupdown</code>，网络配置文件在 <code>/etc/network/interfaces</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">auto lo<br>iface lo inet loopback<br><br>auto eth0<br>iface eth0 inet dhcp<br><br>auto eth1<br>iface eth1 inet static<br>address 192.168.10.10<br>netmask 255.255.255.0<br>gateway 192.168.10.1<br>dns-nameservers 8.8.8.8 8.8.4.4<br><br>auto eth2<br>iface eth2 inet static<br>address 192.168.20.10<br>netmask 255.255.255.0<br>gateway 192.168.20.1<br><br>auto eth3<br>iface eth3 inet static<br>address 192.168.30.10<br>netmask 255.255.255.0<br>gateway 192.168.30.1<br><br></code></pre></td></tr></table></figure>

<p><strong>Ubuntu 17.10 及更高版本</strong>：网络管理工具使用 <code>Netplan</code>，配置文件位于 <code>/etc/netplan/00-installer-config.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Let NetworkManager manage all devices on this system</span><br><span class="hljs-attr">network:</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">renderer:</span> <span class="hljs-string">NetworkManager</span><br>  <span class="hljs-attr">ethernets:</span><br>    <span class="hljs-attr">ens33:</span>            <br>      <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">true</span>                          <br>      <span class="hljs-attr">nameservers:</span><br>        <span class="hljs-attr">addresses:</span> [<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>, <span class="hljs-number">8.8</span><span class="hljs-number">.4</span><span class="hljs-number">.4</span>]       <br><br>    <span class="hljs-attr">ens37:</span><br>      <span class="hljs-attr">addresses:</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span><span class="hljs-string">/24</span>]        <br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span><br>          <span class="hljs-attr">via:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span>                <br>      <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">false</span>                          <br>      <span class="hljs-attr">nameservers:</span><br>        <span class="hljs-attr">addresses:</span> [<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>, <span class="hljs-number">8.8</span><span class="hljs-number">.4</span><span class="hljs-number">.4</span>]      <br><br>    <span class="hljs-attr">ens38:</span><br>      <span class="hljs-attr">addresses:</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.20</span><span class="hljs-number">.10</span><span class="hljs-string">/24</span>]         <br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span><br>          <span class="hljs-attr">via:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.20</span><span class="hljs-number">.1</span>                <br>      <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">false</span>                          <br>      <span class="hljs-attr">nameservers:</span><br>        <span class="hljs-attr">addresses:</span> [<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>, <span class="hljs-number">8.8</span><span class="hljs-number">.4</span><span class="hljs-number">.4</span>]   <br><br>    <span class="hljs-attr">ens39:</span><br>      <span class="hljs-attr">addresses:</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.30</span><span class="hljs-number">.10</span><span class="hljs-string">/24</span>]        <br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span><br>          <span class="hljs-attr">via:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.30</span><span class="hljs-number">.1</span>              <br>      <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">false</span>                     <br>      <span class="hljs-attr">nameservers:</span><br>        <span class="hljs-attr">addresses:</span> [<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>, <span class="hljs-number">8.8</span><span class="hljs-number">.4</span><span class="hljs-number">.4</span>]   <br></code></pre></td></tr></table></figure>

<p>配置完成后执行命令使配置生效。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo netplan apply<br></code></pre></td></tr></table></figure>

<p>执行<code>ifconfig</code>命令查看当前IP地址。</p>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p><strong>子网间连通性</strong></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/7.png" alt="Linux子网间连通性"></p>
<p>Client1(192.168.10.20)</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/8.png" alt="Client1子网间连通性"></p>
<p>Client2(192.168.20.20)</p>
<img src="/images/接入网综合课设/9.png" alt="image-20250308132954522" style="zoom: 80%;" />

<p><strong>子网内连通性</strong></p>
<p>Client1(192.168.10.20)</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/10.png" alt="Client1子网内连通性"></p>
<p>Client2(192.168.20.20)</p>
<img src="/images/接入网综合课设/11.png" alt="image-20250308133215681" style="zoom:80%;" />

<h3 id="任务三"><a href="#任务三" class="headerlink" title="任务三"></a>任务三</h3><h4 id="PPPoE服务器端"><a href="#PPPoE服务器端" class="headerlink" title="PPPoE服务器端"></a>PPPoE服务器端</h4><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/41499761">参考博客:基于Linux环境的PPPOE服务器搭建</a></p>
<ol>
<li>安装PPPoE服务器程序</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo apt-get install pppoe<br></code></pre></td></tr></table></figure>

<p>使用<code>pppoe-server -h</code>查看pppoe安装情况及版本,该PPPoE-Server版本为3.12。</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/12.png" alt="PPPoE服务器版本"></p>
<ol start="2">
<li>编辑&#x2F;etc&#x2F;ppp&#x2F;options文件</li>
</ol>
<ul>
<li>PAP：明文密码认证协议。</li>
<li>CHAP：挑战握手认证协议，<strong>三次握手</strong>机制，使用哈希加密。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">14+ ms-dns 8.8.8.8<br>57  local<br>144 #+pap  // 关闭pap<br>147 -pap<br>151 +chap  // 开启chap<br>154 #-chap<br>208 proxyarp<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>编辑 pppoe-server-options文件</li>
</ol>
<p>创建&#x2F;etc&#x2F;ppp&#x2F;pppoe-server-options文件，使用chap验证协议require-chap，如果使用pap验证协议则配置为 require-pap。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">auth<br>require-chap<br>lcp-echo-interval 60<br>lcp-echo-failure 5     <br>logfile /var/log/pppd.log<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>编辑&#x2F;etc&#x2F;ppp&#x2F;chap-secrets 文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Secrets <span class="hljs-keyword">for</span> authentication using CHAP</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">client	server	secret			IP addresses</span><br>test * test *<br></code></pre></td></tr></table></figure>

<p>用户名为test，密码为test，服务器名和IP地址为任意。</p>
<ol start="4">
<li>开启IP转发功能</li>
</ol>
<p>​	编辑&#x2F;etc&#x2F;sysctl.conf文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">28 net.ipv4.ip_forward=1<br></code></pre></td></tr></table></figure>

<p>​	运行<code>sudo sysctl -p</code>生效配置。</p>
<ol start="5">
<li>启动PPPoE服务器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo pppoe-server -I ens37 -L 192.168.10.10 -R 192.168.10.11 -N 20   <br>sudo pppoe-server -I ens38 -L 192.168.20.10 -R 192.168.20.11 -N 20   <br></code></pre></td></tr></table></figure>

<p><strong>指令含义：</strong></p>
<table>
<thead>
<tr>
<th>pppoe-server</th>
<th>启动 PPPoE 服务器进程</th>
</tr>
</thead>
<tbody><tr>
<td>-I xxx</td>
<td>监听物理网卡xxx，接受客户端的 PPPoE 拨号请求</td>
</tr>
<tr>
<td>-L IP地址</td>
<td>PPP 服务器的 IP 地址</td>
</tr>
<tr>
<td>-R IP地址</td>
<td>客户端分配 IP 的起始地址</td>
</tr>
<tr>
<td>-N n</td>
<td>最多允许 n 个 PPPoE 客户端同时连接</td>
</tr>
</tbody></table>
<ol start="6">
<li>查看PPPoE服务器的启用情况</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">ps -ef|grep pppoe<br></code></pre></td></tr></table></figure>

<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/13.png" alt="pppoe服务器的启用情况"></p>
<ul>
<li>如果需要关闭PPPoE服务器，指令为：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo killall pppoe-server<br></code></pre></td></tr></table></figure>

<ul>
<li><p>每次电脑重启均需要重新运行PPPoE启动命令，设置开机自启动脚本：</p>
<ol>
<li><p>创建systemd服务文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo gedit /etc/systemd/system/pppoe-server.service<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs SHELL">[Unit]<br>Description=PPPoE Server Service<br>After=network.target # 等到网络启动后再启动<br><br>[Service]<br>ExecStart=/usr/local/bin/start-pppoe.sh<br>Restart=always<br>RestartSec=5<br>User=root<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">无限制重启</span><br>StartLimitIntervalSec=0<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo gedit /usr/local/bin/start-pppoe.sh<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建脚本文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo gedit /usr/local/bin/start-pppoe.sh<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>pppoe-server -I ens37 -L 192.168.10.10 -R 192.168.10.11 -N 20<br>pppoe-server -I ens38 -L 192.168.20.10 -R 192.168.20.11 -N 20<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">保持进程运行</span><br>tail -f /dev/null<br></code></pre></td></tr></table></figure>

<p>赋予执行权限：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo chmod +x /usr/local/bin/start-pppoe.sh<br></code></pre></td></tr></table></figure>
</li>
<li><p>重新加载配置，重启服务：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo systemctl daemon-reload<br>sudo systemctl reset-failed<br>sudo systemctl enable pppoe-server<br>sudo systemctl start pppoe-server<br></code></pre></td></tr></table></figure>
</li>
<li><p>重启后检查服务状态：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">ps -ef|grep pppoe<br>sudo systemctl status pppoe-server<br></code></pre></td></tr></table></figure>

<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/24.png" alt="重启后的服务状态"></p>
</li>
</ol>
<ul>
<li><p>注：如果systemd服务文件中没有添加<code>StartLimitIntervalSec=0</code>,脚本文件中没有<code>tail -f /dev/null</code>,则有可能报错：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo systemctl status pppoe-server<br>● pppoe-server.service - PPPoE Server Service<br>     Loaded: loaded (/etc/systemd/system/pppoe-server.service; enabled; vendor&gt;<br>     Active: failed (Result: start-limit-hit) since Mon 2025-03-10 00:16:20 CS&gt;<br>    Process: 2386 ExecStart=/usr/local/bin/start-pppoe.sh (code=exited, status&gt;<br>   Main PID: 2386 (code=exited, status=0/SUCCESS)<br><br>3月 10 00:16:20 xu-virtual-machine systemd[1]: pppoe-server.service: Scheduled&gt;<br>3月 10 00:16:20 xu-virtual-machine systemd[1]: Stopped PPPoE Server Service.<br>3月 10 00:16:20 xu-virtual-machine systemd[1]: pppoe-server.service: Start req&gt;<br>3月 10 00:16:20 xu-virtual-machine systemd[1]: pppoe-server.service: Failed wi&gt;<br>3月 10 00:16:20 xu-virtual-machine systemd[1]: Failed to start PPPoE Server Se&gt;<br></code></pre></td></tr></table></figure>

<p>失败的原因： <code>start-limit-hit</code>，短时间内该服务多次失败，触发了 systemd 的启动限制机制。原脚本<code>start-pppoe.sh</code> 脚本执行完后立即退出，systemd 误以为它崩溃并尝试重启，导致触发 <code>start-limit-hit</code>。</p>
</li>
</ul>
</li>
</ul>
<h4 id="PPPoE客户端"><a href="#PPPoE客户端" class="headerlink" title="PPPoE客户端"></a>PPPoE客户端</h4><p>Windows端拨号步骤：</p>
<ol>
<li>选择网络和Internet设置</li>
</ol>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/14.png" alt="选择网络和Internet设置"></p>
<ol start="2">
<li>选择拨号-设置新连接-连接到Internet-下一页-宽带</li>
</ol>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/15.png" alt="拨号选择"></p>
<ol start="3">
<li><p>输入用户名和密码</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/16.png" alt="用户名和密码"></p>
</li>
<li><p>连接成功</p>
</li>
</ol>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/17.png" alt="拨号成功"></p>
<h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><p> 客户端连接成功后，在服务器端输入<code>ifconfig</code>会看到PPP接口信息</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/18.png" alt="PPP接口"></p>
<p>在客户端输入<code>ipconfig /all</code>  会看到PPP服务器分配的IP地址</p>
<p><strong>Client1(192.168.10.20)</strong></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/19.png" alt="Client1"></p>
<p><strong>测试ping通：</strong></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/20.png" alt="Client1"></p>
<p><strong>Client2(192.168.20.20)</strong></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/21.png" alt="Client2"></p>
<p>测试ping通：</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/22.png" alt="Client2"></p>
<p><strong>抓包分析</strong></p>
<p><strong>注意</strong>：执行 <code>sudo wireshark</code> </p>
<p>Filter 选择pppoe|ppoes。</p>
<p><strong>PPPoE报文类型</strong></p>
<table>
<thead>
<tr>
<th>阶段</th>
<th>以太网协议号</th>
<th>报文类型</th>
</tr>
</thead>
<tbody><tr>
<td><strong>发现阶段</strong>（Discovery）</td>
<td><code>0x8863</code></td>
<td>PADI, PADO, PADR, PADS, PADT</td>
</tr>
<tr>
<td><strong>会话阶段</strong>（Session）</td>
<td><code>0x8864</code></td>
<td>PPP 数据包（LCP、PAP&#x2F;CHAP、IP 数据等）</td>
</tr>
</tbody></table>
<p><strong>PPPoE交互过程</strong></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/32.png" alt="PPPoE交互过程"></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/25.png" alt="抓包pppoed"></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/26.png" alt="抓包pppoes-1"></p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/27.png" alt="抓包pppoes-2"></p>
<p><strong>PPPoE 发现阶段</strong></p>
<p>PPPoE 发现阶段用于 建立 PPPoE 连接有5种报文：</p>
<ol>
<li>PADI（PPPoE Active Discovery Initiation）</li>
</ol>
<ul>
<li><strong>客户端 → 广播</strong> 发送 <strong>PADI</strong>（发现请求）。</li>
<li>用于查找可用的 PPPoE 服务器（AC, Access Concentrator）。</li>
<li><strong>目标 MAC 地址：<code>FF:FF:FF:FF:FF:FF</code></strong>（广播）。</li>
<li>只有Service-Name为空的服务器会响应。</li>
</ul>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/28.png" alt="抓包pppoed-PADI"></p>
<ol start="2">
<li>PADO（PPPoE Active Discovery Offer）</li>
</ol>
<ul>
<li><strong>服务器（AC）→ 客户端</strong> 回复 <strong>PADO</strong>（提供服务）。</li>
<li>服务器响应客户端，表明自己可用。</li>
<li>包含 <strong>服务器名称</strong> 和 <strong>支持的服务</strong>。</li>
</ul>
<p><img src="/./images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/29.png" alt="抓包pppoed-PADO"></p>
<ol start="3">
<li>PADR（PPPoE Active Discovery Request）</li>
</ol>
<ul>
<li><p><strong>客户端 → 服务器（AC）</strong> 发送 <strong>PADR</strong>（连接请求）。</p>
</li>
<li><p>用户主机可能会收到多个 PADO，但仅查看它收到的 PADO 数据包并选择一个，并请求建立会话。</p>
</li>
<li><p>包含 <strong>服务名</strong> 和 <strong>唯一的标识符</strong>。</p>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/30.png" alt="抓包pppoed-PADR"></p>
</li>
</ul>
<ol start="4">
<li>PADS（PPPoE Active Discovery Session-confirmation）</li>
</ol>
<ul>
<li><strong>服务器（AC）→ 客户端</strong> 发送 <strong>PADS</strong>（会话确认）。</li>
<li><strong>分配一个 PPPoE 会话 ID</strong>，表示连接已建立。</li>
</ul>
<p><img src="/images/%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%BC%E5%90%88%E8%AF%BE%E8%AE%BE/31.png" alt="抓包pppoed-PADS"></p>
<ol start="5">
<li>PADT（PPPoE Active Discovery Terminate）</li>
</ol>
<ul>
<li>客户端或服务器 发送 <strong>PADT</strong>（终止连接）。</li>
<li>关闭 PPPoE 连接。</li>
</ul>
<p><strong>PPPoE 会话阶段</strong></p>
<p>PPPoE 发现阶段完成后，客户端和服务器通过 <strong>PPPoE 会话 ID</strong> 进行通信。<br> 此时 PPPoE 封装标准 PPP 报文，包括4种报文：</p>
<ol>
<li><strong>LCP（Link Control Protocol）</strong>：链路协商。</li>
<li><strong>PAP&#x2F;CHAP（Password Authentication Protocol &#x2F; Challenge Handshake Authentication Protocol）</strong>:  用户身份认证。</li>
<li><strong>NCP（Network Control Protocol)</strong> : 分配 IP 地址。</li>
<li><strong>IP 数据报文</strong>: 网络通信数据（TCP&#x2F;IP、UDP）。</li>
</ol>

        </div>
        
            <div class="post-container">
            <aside class="toc-container">
                <button class="toc-toggle">文章目录</button>
                <nav class="toc" id="toc"></nav>
            </aside>
        </div>
        
    </div>


    <!-- 返回主页链接 -->
    <div class="text-center my-8">
        <a href="/" class="text-hacker-color1 underline hover:text-hacker-color2">← Back to Home</a>
    </div>

      
      <script src="/js/toc.js"></script>  <!-- 引入 TOC 逻辑 -->
      
      

    <footer class="bg-black text-gray-400 py-4">
    <div class="container mx-auto text-center">
      <p>© <span id="current-year"></span>  Li-shuangyi 
        <br> Powered by <a class="hover:text-white duration-150 hover:underline decoration-slice" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & <a class="hover:text-white duration-150 hover:underline decoration-slice" target="_blank" rel="noopener" href="https://github.com/m310ct/hexo-theme-hexploit">Hexpolit</a></p>
    </div>
  </footer>
  
  <script> 
    document.getElementById("current-year").textContent = new Date().getFullYear();
  </script>
  


</body>
</html>
